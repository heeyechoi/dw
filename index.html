<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>멍 잉크 퍼짐</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      background: white;
      overflow: hidden;
    }
    canvas {
      display: block;
    }
  </style>
</head>
<body>
<canvas id="canvas"></canvas>
<script>
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

let currentBlob = null;

// 텍스트 + 노이즈 그리기용 임시 캔버스
const blobCanvas = document.createElement("canvas");
blobCanvas.width = 1000;
blobCanvas.height = 1000;
const blobCtx = blobCanvas.getContext("2d");

// 클릭하면 '멍' 글자 하나 생성
canvas.addEventListener("click", (e) => {
  const size = Math.random() * 600 + 200;
  currentBlob = {
    x: e.clientX,
    y: e.clientY,
    size: size,
    baseSize: size,
    alpha: 1,
    growth: 1.01,
    fade: 0.98
  };
});

function drawBlob(blob) {
  // 임시 캔버스 초기화
  blobCtx.clearRect(0, 0, blobCanvas.width, blobCanvas.height);

  // 1. 텍스트 그리기 (중앙)
  blobCtx.save();
  blobCtx.fillStyle = `rgba(0, 0, 0, ${blob.alpha})`;
  blobCtx.font = `bold ${blob.size}px sans-serif`;
  blobCtx.textAlign = 'center';
  blobCtx.textBaseline = 'middle';
  blobCtx.fillText("멍", blobCanvas.width/2, blobCanvas.height/2);
  blobCtx.restore();

  // 2. 텍스트 픽셀 데이터 추출
  const imageData = blobCtx.getImageData(0, 0, blobCanvas.width, blobCanvas.height);
  const data = imageData.data;

  // 3. 노이즈 적용: 텍스트 내부에만 랜덤 노이즈 입힘
  for (let i = 0; i < data.length; i += 4) {
    const alpha = data[i + 3];
    if (alpha > 20 && Math.random() < 0.1) {
      const noise = Math.floor(Math.random() * 60); // 블랙~회색
      data[i] = noise;
      data[i + 1] = noise;
      data[i + 2] = noise;
    }
  }

  blobCtx.putImageData(imageData, 0, 0);

  // 4. 메인 캔버스에 복사 (위치 보정)
  const dx = blob.x - blobCanvas.width / 2;
  const dy = blob.y - blobCanvas.height / 2;
  ctx.globalAlpha = blob.alpha;
  ctx.drawImage(blobCanvas, dx, dy);
  ctx.globalAlpha = 1;
}

function animate() {
  ctx.fillStyle = 'rgba(255,255,255,0.05)';
  ctx.fillRect(0, 0, canvas.width, canvas.height);

  if (currentBlob) {
    drawBlob(currentBlob);

    currentBlob.size *= currentBlob.growth;
    currentBlob.alpha *= currentBlob.fade;

    if (currentBlob.alpha < 0.01) {
      currentBlob = null;
    }
  }

  requestAnimationFrame(animate);
}

animate();
</script>
</body>
</html>
